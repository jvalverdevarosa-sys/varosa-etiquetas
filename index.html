<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VAROSA - Imprimir Etiquetas</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background: #1a1a2e; color: #fff; min-height: 100vh; }
        .screen-only { padding: 2rem; max-width: 900px; margin: 0 auto; }
        h1 { text-align: center; margin-bottom: 0.5rem; color: #4ecdc4; }
        .subtitle { text-align: center; color: #888; margin-bottom: 2rem; }
        .order-info { background: rgba(255,255,255,0.05); border-radius: 12px; padding: 1.5rem; margin-bottom: 2rem; display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; }
        .order-info-item { display: flex; flex-direction: column; }
        .order-info-label { font-size: 0.75rem; color: #888; text-transform: uppercase; margin-bottom: 0.25rem; }
        .order-info-value { font-size: 1.1rem; font-weight: 600; }
        .preview-container { background: #fff; border-radius: 12px; padding: 2rem; margin-bottom: 2rem; }
        .preview-title { color: #333; font-size: 0.9rem; margin-bottom: 1rem; text-align: center; }
        .labels-preview { display: flex; flex-direction: column; gap: 1rem; align-items: center; }
        .print-actions { display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap; }
        .btn { padding: 1rem 2rem; border: none; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.2s; }
        .btn-primary { background: #4ecdc4; color: #000; }
        .btn-primary:hover { background: #3dbdb5; transform: translateY(-2px); }
        .btn-secondary { background: rgba(255,255,255,0.1); color: #fff; border: 1px solid rgba(255,255,255,0.2); }
        .btn-secondary:hover { background: rgba(255,255,255,0.2); }
        .instructions { background: rgba(78, 205, 196, 0.1); border: 1px solid rgba(78, 205, 196, 0.3); border-radius: 8px; padding: 1rem; margin-top: 2rem; }
        .instructions h3 { color: #4ecdc4; margin-bottom: 0.5rem; }
        .instructions ol { margin-left: 1.5rem; color: #aaa; }
        .instructions li { margin-bottom: 0.5rem; }

        .label { width: 416px; height: 94px; background: #fff; color: #000; font-family: Arial, sans-serif; border: 1px solid #000; display: flex; flex-direction: row; align-items: stretch; page-break-inside: avoid; break-inside: avoid; }
        .qr-section { width: 80px; display: flex; flex-direction: column; align-items: center; justify-content: center; border-right: 1px solid #000; background: #fff; padding: 4px; }
        .qr-image { width: 65px; height: 65px; }
        .qr-label { font-size: 6px; color: #666; margin-top: 2px; text-transform: uppercase; }
        .main-section { flex: 1; display: flex; flex-direction: column; padding: 4px 8px; justify-content: space-between; overflow: hidden; }
        .header-row { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #ccc; padding-bottom: 3px; }
        .logo { font-weight: 900; font-size: 11px; letter-spacing: 1px; }
        .ov-num { font-weight: bold; font-size: 11px; border: 1px solid #000; padding: 1px 6px; background: #000; color: #fff; }
        .ruta-badge { font-size: 9px; font-weight: bold; background: #f0f0f0; padding: 1px 6px; border-radius: 3px; }
        .info-row { display: flex; gap: 4px; align-items: baseline; }
        .info-label { font-size: 7px; color: #666; text-transform: uppercase; }
        .info-value { font-size: 10px; font-weight: bold; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .cliente-row { max-width: 220px; }
        .notas-row { font-size: 8px; color: #444; font-style: italic; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 220px; }
        .bulto-section { width: 85px; display: flex; flex-direction: column; align-items: center; justify-content: center; border-left: 1px solid #000; background: #f8f8f8; padding: 4px; }
        .bulto-label { font-size: 7px; color: #666; text-transform: uppercase; margin-bottom: 2px; }
        .bulto-display { display: flex; align-items: center; gap: 3px; }
        .bulto-box { border: 2px solid #000; padding: 2px 8px; font-size: 20px; font-weight: 900; text-align: center; min-width: 30px; background: #fff; }
        .bulto-de { font-size: 10px; font-weight: bold; }

        @media print {
            .screen-only { display: none !important; }
            body { background: #fff; margin: 0; padding: 0; }
            .print-container { display: block !important; }
            .label { width: 110mm; height: 25mm; margin: 0; padding: 0; border: 1px solid #000; page-break-after: always; break-after: page; }
            .label:last-child { page-break-after: avoid; }
            .qr-section { width: 22mm; }
            .qr-image { width: 18mm; height: 18mm; }
            .bulto-section { width: 22mm; }
            .logo { font-size: 9pt; }
            .ov-num { font-size: 9pt; }
            .ruta-badge { font-size: 8pt; }
            .info-value { font-size: 9pt; }
            .bulto-box { font-size: 16pt; padding: 1px 6px; }
            @page { size: 110mm 25mm; margin: 0; }
        }

        .print-container { display: none; }
        .error-message { background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 8px; padding: 2rem; text-align: center; color: #ef4444; }
    </style>
</head>
<body>
    <div class="screen-only">
        <h1>üñ®Ô∏è Imprimir Etiquetas de Alisto</h1>
        <p class="subtitle">Vista previa antes de imprimir</p>
        <div id="content-area"></div>
    </div>
    <div class="print-container" id="print-container"></div>

    <script>
        function getUrlParams() {
            var params = new URLSearchParams(window.location.search);
            return {
                ov: params.get('ov') || '',
                cliente: params.get('cliente') || '',
                ruta: params.get('ruta') || '',
                notas: params.get('notas') || '',
                cantidad_bultos: parseInt(params.get('bultos')) || 0
            };
        }

        var orderData = getUrlParams();

        if (!orderData.ov) {
            orderData = {
                ov: "SO-03210",
                cliente: "HOTEL MARGARITAS Y GIRASOLES",
                ruta: "VENECIA - RIO CUARTO",
                notas: "NO FACTURAR - ES UN PENDIENTE",
                cantidad_bultos: 3
            };
        }

        function getQRUrl(text) {
            return 'https://quickchart.io/qr?text=' + encodeURIComponent(text) + '&size=150&margin=1';
        }

        function createLabel(bulto, total) {
            var qrData = orderData.ov + '|B' + bulto + '/' + total;
            var notasHtml = orderData.notas ? '<div class="notas-row">üìù ' + orderData.notas + '</div>' : '';
            
            return '<div class="label">' +
                '<div class="qr-section">' +
                    '<img class="qr-image" src="' + getQRUrl(qrData) + '" alt="QR">' +
                    '<span class="qr-label">Escanear</span>' +
                '</div>' +
                '<div class="main-section">' +
                    '<div class="header-row">' +
                        '<span class="logo">VAROSA</span>' +
                        '<span class="ov-num">' + orderData.ov + '</span>' +
                        '<span class="ruta-badge">üìç ' + orderData.ruta + '</span>' +
                    '</div>' +
                    '<div class="info-row cliente-row">' +
                        '<span class="info-label">Cliente:</span>' +
                        '<span class="info-value">' + orderData.cliente + '</span>' +
                    '</div>' +
                    notasHtml +
                '</div>' +
                '<div class="bulto-section">' +
                    '<span class="bulto-label">Bulto</span>' +
                    '<div class="bulto-display">' +
                        '<div class="bulto-box">' + bulto + '</div>' +
                        '<span class="bulto-de">/</span>' +
                        '<div class="bulto-box">' + total + '</div>' +
                    '</div>' +
                '</div>' +
            '</div>';
        }

        function init() {
            var contentArea = document.getElementById('content-area');
            var printContainer = document.getElementById('print-container');

            if (orderData.cantidad_bultos < 1) {
                contentArea.innerHTML = '<div class="error-message"><h2>‚ö†Ô∏è Error</h2><p>No se especific√≥ cantidad de bultos.</p></div>';
                return;
            }

            var labelsHtml = '';
            for (var i = 1; i <= orderData.cantidad_bultos; i++) {
                labelsHtml += createLabel(i, orderData.cantidad_bultos);
            }

            contentArea.innerHTML = 
                '<div class="order-info">' +
                    '<div class="order-info-item"><span class="order-info-label">Orden</span><span class="order-info-value">' + orderData.ov + '</span></div>' +
                    '<div class="order-info-item"><span class="order-info-label">Cliente</span><span class="order-info-value">' + orderData.cliente + '</span></div>' +
                    '<div class="order-info-item"><span class="order-info-label">Ruta</span><span class="order-info-value">' + orderData.ruta + '</span></div>' +
                    '<div class="order-info-item"><span class="order-info-label">Bultos</span><span class="order-info-value" style="color:#4ecdc4;font-size:1.5rem">' + orderData.cantidad_bultos + '</span></div>' +
                    (orderData.notas ? '<div class="order-info-item" style="grid-column:1/-1"><span class="order-info-label">Notas</span><span class="order-info-value" style="color:#ffa500">' + orderData.notas + '</span></div>' : '') +
                '</div>' +
                '<div class="preview-container">' +
                    '<div class="preview-title">Vista previa de ' + orderData.cantidad_bultos + ' etiqueta(s):</div>' +
                    '<div class="labels-preview">' + labelsHtml + '</div>' +
                '</div>' +
                '<div class="print-actions">' +
                    '<button class="btn btn-primary" onclick="window.print()">üñ®Ô∏è Imprimir</button>' +
                    '<button class="btn btn-secondary" onclick="window.close()">‚úï Cerrar</button>' +
                '</div>' +
                '<div class="instructions"><h3>üìã Instrucciones</h3><ol>' +
                    '<li>Impresora SATO encendida</li>' +
                    '<li>Tama√±o: 110mm x 25mm</li>' +
                    '<li>M√°rgenes: Ninguno</li>' +
                '</ol></div>';

            printContainer.innerHTML = labelsHtml;
        }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
