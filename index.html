<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VAROSA - Imprimir Etiquetas</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: #1a1a2e;
            color: #fff;
            min-height: 100vh;
        }

        .screen-only {
            padding: 2rem;
            max-width: 900px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 0.5rem;
            color: #4ecdc4;
        }

        .subtitle {
            text-align: center;
            color: #888;
            margin-bottom: 2rem;
        }

        .order-info {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .order-info-item {
            display: flex;
            flex-direction: column;
        }

        .order-info-label {
            font-size: 0.75rem;
            color: #888;
            text-transform: uppercase;
            margin-bottom: 0.25rem;
        }

        .order-info-value {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .preview-container {
            background: #fff;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .preview-title {
            color: #333;
            font-size: 0.9rem;
            margin-bottom: 1rem;
            text-align: center;
        }

        .labels-preview {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            align-items: center;
        }

        .print-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 1rem 2rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #4ecdc4;
            color: #000;
        }

        .btn-primary:hover {
            background: #3dbdb5;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: #fff;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .btn-secondary:hover {
            background: rgba(255,255,255,0.2);
        }

        .instructions {
            background: rgba(78, 205, 196, 0.1);
            border: 1px solid rgba(78, 205, 196, 0.3);
            border-radius: 8px;
            padding: 1rem;
            margin-top: 2rem;
        }

        .instructions h3 {
            color: #4ecdc4;
            margin-bottom: 0.5rem;
        }

        .instructions ol {
            margin-left: 1.5rem;
            color: #aaa;
        }

        .instructions li {
            margin-bottom: 0.5rem;
        }

        /* =============================================
           ESTILOS DE ETIQUETA - 110mm x 25mm
           ============================================= */
        .label {
            width: 416px;
            height: 94px;
            background: #fff;
            color: #000;
            font-family: Arial, sans-serif;
            border: 1px solid #000;
            display: flex;
            flex-direction: row;
            align-items: stretch;
            page-break-inside: avoid;
            break-inside: avoid;
        }

        .qr-section {
            width: 80px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-right: 1px solid #000;
            background: #fff;
            padding: 4px;
        }

        .qr-container {
            width: 65px;
            height: 65px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .qr-container svg {
            width: 100%;
            height: 100%;
        }

        .qr-label {
            font-size: 6px;
            color: #666;
            margin-top: 2px;
            text-transform: uppercase;
        }

        .main-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 4px 8px;
            justify-content: space-between;
            overflow: hidden;
        }

        .header-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #ccc;
            padding-bottom: 3px;
        }

        .logo {
            font-weight: 900;
            font-size: 11px;
            letter-spacing: 1px;
        }

        .ov-num {
            font-weight: bold;
            font-size: 11px;
            border: 1px solid #000;
            padding: 1px 6px;
            background: #000;
            color: #fff;
        }

        .ruta-badge {
            font-size: 9px;
            font-weight: bold;
            background: #f0f0f0;
            padding: 1px 6px;
            border-radius: 3px;
        }

        .info-row {
            display: flex;
            gap: 4px;
            align-items: baseline;
        }

        .info-label {
            font-size: 7px;
            color: #666;
            text-transform: uppercase;
        }

        .info-value {
            font-size: 10px;
            font-weight: bold;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .cliente-row {
            max-width: 220px;
        }

        .notas-row {
            font-size: 8px;
            color: #444;
            font-style: italic;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 220px;
        }

        .bulto-section {
            width: 85px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-left: 1px solid #000;
            background: #f8f8f8;
            padding: 4px;
        }

        .bulto-label {
            font-size: 7px;
            color: #666;
            text-transform: uppercase;
            margin-bottom: 2px;
        }

        .bulto-display {
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .bulto-box {
            border: 2px solid #000;
            padding: 2px 8px;
            font-size: 20px;
            font-weight: 900;
            text-align: center;
            min-width: 30px;
            background: #fff;
        }

        .bulto-de {
            font-size: 10px;
            font-weight: bold;
        }

        @media print {
            .screen-only { display: none !important; }
            body { background: #fff; margin: 0; padding: 0; }
            .print-container { display: block !important; }

            .label {
                width: 110mm;
                height: 25mm;
                margin: 0;
                padding: 0;
                border: 1px solid #000;
                page-break-after: always;
                break-after: page;
            }

            .label:last-child {
                page-break-after: avoid;
            }

            .qr-section {
                width: 22mm;
            }

            .qr-container {
                width: 18mm;
                height: 18mm;
            }

            .bulto-section {
                width: 22mm;
            }

            .logo { font-size: 9pt; }
            .ov-num { font-size: 9pt; }
            .ruta-badge { font-size: 8pt; }
            .info-value { font-size: 9pt; }
            .bulto-box { font-size: 16pt; padding: 1px 6px; }

            @page {
                size: 110mm 25mm;
                margin: 0;
            }
        }

        .print-container { display: none; }

        .error-message {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            color: #ef4444;
        }

        .error-message h2 {
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <div class="screen-only">
        <h1>üñ®Ô∏è Imprimir Etiquetas de Alisto</h1>
        <p class="subtitle">Vista previa antes de imprimir</p>
        <div id="content-area"></div>
    </div>

    <div class="print-container" id="print-container"></div>

    <!-- QR Code Generator Library (embedded) -->
    <script>
    var QRCode=function(){function a(a){this.mode=c.MODE_8BIT_BYTE;this.data=a;this.parsedData=[];for(var b=[],d=0;d<this.data.length;d++){var e=this.data.charCodeAt(d);e>65536?(b[0]=240|(1835008&e)>>>18,b[1]=128|(258048&e)>>>12,b[2]=128|(4032&e)>>>6,b[3]=128|63&e):e>2048?(b[0]=224|(61440&e)>>>12,b[1]=128|(4032&e)>>>6,b[2]=128|63&e):e>128?(b[0]=192|(1984&e)>>>6,b[1]=128|63&e):b[0]=e;for(var f=0;f<b.length;f++)this.parsedData.push(b[f]);b=[]}}function b(a,b){this.typeNumber=a;this.errorCorrectLevel=b;this.modules=null;this.moduleCount=0;this.dataCache=null;this.dataList=[]}function i(a,b){if(void 0==a.length)throw Error(a.length+"/"+b);for(var c=0;c<a.length&&0==a[c];)c++;this.num=Array(a.length-c+b);for(var d=0;d<a.length-c;d++)this.num[d]=a[c+d]}function j(a,b){this.totalCount=a;this.dataCount=b}function k(){this.buffer=[];this.length=0}var c={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},d={L:1,M:0,Q:3,H:2},e={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},f=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]],g=function(){var a=function(a,b){switch(a){case c.MODE_NUMBER:return 10>b?10:27>b?12:14;case c.MODE_ALPHA_NUM:return 10>b?9:27>b?11:13;case c.MODE_8BIT_BYTE:return 10>b?8:27>b?16:16;case c.MODE_KANJI:return 10>b?8:27>b?10:12;default:throw Error("mode:"+a)}};return{getErrorCorrectPolynomial:function(a){for(var b=i([1],0),c=0;c<a;c++)b=b.multiply(i([1,h.gexp(c)],0));return b},getLengthInBits:a,getLostPoint:function(a){for(var b=a.getModuleCount(),c=0,d=0;d<b;d++)for(var e=0;e<b;e++){for(var f=0,g=a.isDark(d,e),h=-1;h<=1;h++)if(!(0>d+h||d+h>=b))for(var i=-1;i<=1;i++)0>e+i||e+i>=b||0==h&&0==i||g==a.isDark(d+h,e+i)&&f++;f>5&&(c+=3+f-5)}for(d=0;d<b-1;d++)for(e=0;e<b-1;e++)f=0,a.isDark(d,e)&&f++,a.isDark(d+1,e)&&f++,a.isDark(d,e+1)&&f++,a.isDark(d+1,e+1)&&f++,0!=f&&4!=f||(c+=3);for(d=0;d<b;d++)for(e=0;e<b-6;e++)a.isDark(d,e)&&!a.isDark(d,e+1)&&a.isDark(d,e+2)&&a.isDark(d,e+3)&&a.isDark(d,e+4)&&!a.isDark(d,e+5)&&a.isDark(d,e+6)&&(c+=40);for(e=0;e<b;e++)for(d=0;d<b-6;d++)a.isDark(d,e)&&!a.isDark(d+1,e)&&a.isDark(d+2,e)&&a.isDark(d+3,e)&&a.isDark(d+4,e)&&!a.isDark(d+5,e)&&a.isDark(d+6,e)&&(c+=40);for(f=e=0;e<b;e++)for(d=0;d<b;d++)a.isDark(d,e)&&f++;return c+=10*(Math.abs(100*f/b/b-50)/5)}}}(),h=function(){for(var a=Array(256),b=Array(256),c=0;8>c;c++)a[c]=1<<c;for(c=8;256>c;c++)a[c]=a[c-4]^a[c-5]^a[c-6]^a[c-8];for(c=0;255>c;c++)b[a[c]]=c;return{glog:function(a){if(1>a)throw Error("glog("+a+")");return b[a]},gexp:function(b){for(;0>b;)b+=255;for(;b>=256;)b-=255;return a[b]}}}();a.prototype={getLength:function(){return this.parsedData.length},write:function(a){for(var b=0;b<this.parsedData.length;b++)a.put(this.parsedData[b],8)}};b.prototype={addData:function(b){this.dataList.push(new a(b));this.dataCache=null},isDark:function(a,b){if(0>a||this.moduleCount<=a||0>b||this.moduleCount<=b)throw Error(a+","+b);return this.modules[a][b]},getModuleCount:function(){return this.moduleCount},make:function(){this.makeImpl(!1,this.getBestMaskPattern())},getBestMaskPattern:function(){for(var a=0,b=0,c=0;8>c;c++){this.makeImpl(!0,c);var d=g.getLostPoint(this);(0==c||a>d)&&(a=d,b=c)}return b},makeImpl:function(a,b){this.moduleCount=4*this.typeNumber+17;this.modules=Array(this.moduleCount);for(var c=0;c<this.moduleCount;c++){this.modules[c]=Array(this.moduleCount);for(var d=0;d<this.moduleCount;d++)this.modules[c][d]=null}this.setupPositionProbePattern(0,0);this.setupPositionProbePattern(this.moduleCount-7,0);this.setupPositionProbePattern(0,this.moduleCount-7);this.setupPositionAdjustPattern();this.setupTimingPattern();this.setupTypeInfo(a,b);7<=this.typeNumber&&this.setupTypeNumber(a);null==this.dataCache&&(this.dataCache=b.createData(this.typeNumber,this.errorCorrectLevel,this.dataList));this.mapData(this.dataCache,b)},setupPositionProbePattern:function(a,b){for(var c=-1;7>=c;c++)if(!(-1>=a+c||this.moduleCount<=a+c))for(var d=-1;7>=d;d++)-1>=b+d||this.moduleCount<=b+d||(this.modules[a+c][b+d]=0<=c&&6>=c&&(0==d||6==d)||0<=d&&6>=d&&(0==c||6==c)||2<=c&&4>=c&&2<=d&&4>=d?!0:!1)},setupTimingPattern:function(){for(var a=8;a<this.moduleCount-8;a++)null==this.modules[a][6]&&(this.modules[a][6]=0==a%2);for(a=8;a<this.moduleCount-8;a++)null==this.modules[6][a]&&(this.modules[6][a]=0==a%2)},setupPositionAdjustPattern:function(){for(var a=g.getPatternPosition(this.typeNumber),b=0;b<a.length;b++)for(var c=0;c<a.length;c++){var d=a[b],e=a[c];if(null==this.modules[d][e])for(var f=-2;2>=f;f++)for(var h=-2;2>=h;h++)this.modules[d+f][e+h]=-2==f||2==f||-2==h||2==h||0==f&&0==h?!0:!1}},setupTypeNumber:function(a){for(var b=g.getBCHTypeNumber(this.typeNumber),c=0;18>c;c++){var d=!a&&1==(b>>c&1);this.modules[Math.floor(c/3)][c%3+this.moduleCount-8-3]=d}for(c=0;18>c;c++)d=!a&&1==(b>>c&1),this.modules[c%3+this.moduleCount-8-3][Math.floor(c/3)]=d},setupTypeInfo:function(a,b){for(var c=this.errorCorrectLevel<<3|b,d=g.getBCHTypeInfo(c),e=0;15>e;e++){var f=!a&&1==(d>>e&1);6>e?this.modules[e][8]=f:8>e?this.modules[e+1][8]=f:this.modules[this.moduleCount-15+e][8]=f}for(e=0;15>e;e++)f=!a&&1==(d>>e&1),8>e?this.modules[8][this.moduleCount-e-1]=f:9>e?this.modules[8][15-e-1+1]=f:this.modules[8][15-e-1]=f;this.modules[this.moduleCount-8][8]=!a},mapData:function(a,b){for(var c=-1,d=this.moduleCount-1,e=7,f=0,h=this.moduleCount-1;h>0;h-=2)for(6==h&&h--;;){for(var i=0;2>i;i++)if(null==this.modules[d][h-i]){var j=!1;f<a.length&&(j=1==(a[f]>>>e&1));g.getMask(b,d,h-i)&&(j=!j);this.modules[d][h-i]=j;e--;-1>e&&(f++,e=7)}d+=c;if(0>d||this.moduleCount<=d){d-=c;c=-c;break}}}};b.createData=function(a,c,d){for(var e=j.getRSBlocks(a,c),f=new k,h=0;h<d.length;h++){var i=d[h];f.put(i.mode,4);f.put(i.getLength(),g.getLengthInBits(i.mode,a));i.write(f)}for(h=a=0;h<e.length;h++)a+=e[h].dataCount;if(f.getLengthInBits()>8*a)throw Error("code length overflow. ("+f.getLengthInBits()+">"+8*a+")");for(f.getLengthInBits()+4<=8*a&&f.put(0,4);0!=f.getLengthInBits()%8;)f.putBit(!1);for(;!(f.getLengthInBits()>=8*a);)f.put(236,8),f.getLengthInBits()>=8*a||f.put(17,8);return b.createBytes(f,e)};b.createBytes=function(a,b){for(var c=0,d=0,e=0,f=Array(b.length),j=Array(b.length),k=0;k<b.length;k++){var l=b[k].dataCount,m=b[k].totalCount-l;d=Math.max(d,l);e=Math.max(e,m);f[k]=Array(l);for(var n=0;n<f[k].length;n++)f[k][n]=255&a.buffer[n+c];c+=l;n=g.getErrorCorrectPolynomial(m);l=(new i(f[k],n.getLength()-1)).mod(n);j[k]=Array(n.getLength()-1);for(n=0;n<j[k].length;n++)m=n+l.getLength()-j[k].length,j[k][n]=0<=m?l.get(m):0}for(n=a=0;n<b.length;n++)a+=b[n].totalCount;a=Array(a);for(n=c=0;n<d;n++)for(k=0;k<b.length;k++)n<f[k].length&&(a[c++]=f[k][n]);for(n=0;n<e;n++)for(k=0;k<b.length;k++)n<j[k].length&&(a[c++]=j[k][n]);return a};for(var l=0,m={L:1,M:0,Q:3,H:2},n=[],o=0;8>o;o++)n.push(o);g.getPatternPosition=function(a){return n[a]};g.getPatternPosition=function(a){return[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]][a-1]};g.getBCHTypeInfo=function(a){for(var b=a<<10;0<=g.getBCHDigit(b)-10;)b^=1335<<g.getBCHDigit(b)-10;return(a<<10|b)^21522};g.getBCHTypeNumber=function(a){for(var b=a<<12;0<=g.getBCHDigit(b)-12;)b^=7973<<g.getBCHDigit(b)-12;return a<<12|b};g.getBCHDigit=function(a){for(var b=0;0!=a;)b++,a>>>=1;return b};g.getMask=function(a,b,c){switch(a){case e.PATTERN000:return 0==(b+c)%2;case e.PATTERN001:return 0==b%2;case e.PATTERN010:return 0==c%3;case e.PATTERN011:return 0==(b+c)%3;case e.PATTERN100:return 0==(Math.floor(b/2)+Math.floor(c/3))%2;case e.PATTERN101:return 0==b*c%2+b*c%3;case e.PATTERN110:return 0==(b*c%2+b*c%3)%2;case e.PATTERN111:return 0==(b*c%3+(b+c)%2)%2;default:throw Error("bad maskPattern:"+a)}};i.prototype={get:function(a){return this.num[a]},getLength:function(){return this.num.length},multiply:function(a){for(var b=Array(this.getLength()+a.getLength()-1),c=0;c<this.getLength();c++)for(var d=0;d<a.getLength();d++)b[c+d]^=h.gexp(h.glog(this.get(c))+h.glog(a.get(d)));return new i(b,0)},mod:function(a){if(0>this.getLength()-a.getLength())return this;for(var b=h.glog(this.get(0))-h.glog(a.get(0)),c=Array(this.getLength()),d=0;d<this.getLength();d++)c[d]=this.get(d);for(d=0;d<a.getLength();d++)c[d]^=h.gexp(h.glog(a.get(d))+b);return(new i(c,0)).mod(a)}};j.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12,7,37,13],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]];j.getRSBlocks=function(a,b){var c=j.getRsBlockTable(a,b);if(void 0==c)throw Error("bad rs block @ typeNumber:"+a+"/errorCorrectLevel:"+b);for(var d=c.length/3,e=[],f=0;f<d;f++)for(var g=c[3*f+0],h=c[3*f+1],i=c[3*f+2],k=0;k<g;k++)e.push(new j(h,i));return e};j.getRsBlockTable=function(a,b){switch(b){case d.L:return j.RS_BLOCK_TABLE[4*(a-1)+0];case d.M:return j.RS_BLOCK_TABLE[4*(a-1)+1];case d.Q:return j.RS_BLOCK_TABLE[4*(a-1)+2];case d.H:return j.RS_BLOCK_TABLE[4*(a-1)+3]}};k.prototype={get:function(a){return 1==(this.buffer[Math.floor(a/8)]>>>7-a%8&1)},put:function(a,b){for(var c=0;c<b;c++)this.putBit(1==(a>>>b-c-1&1))},getLengthInBits:function(){return this.length},putBit:function(a){var b=Math.floor(this.length/8);this.buffer.length<=b&&this.buffer.push(0);a&&(this.buffer[b]|=128>>>this.length%8);this.length++}};return{create:function(a,c){c=c||"M";var e=new b(0,m[c]);e.addData(a);e.make();return e},toSVG:function(a,b){b=b||{};var c=a.getModuleCount(),d=b.margin!==void 0?b.margin:4,e=b.size||100,f=e/(c+2*d),g=['<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 '+e+" "+e+'">'];g.push('<rect width="100%" height="100%" fill="'+(b.background||"#fff")+'"/>');g.push('<g fill="'+(b.color||"#000")+'">');for(var h=0;h<c;h++)for(var i=0;i<c;i++)a.isDark(h,i)&&g.push('<rect x="'+((i+d)*f).toFixed(2)+'" y="'+((h+d)*f).toFixed(2)+'" width="'+(f+.5).toFixed(2)+'" height="'+(f+.5).toFixed(2)+'"/>');g.push("</g></svg>");return g.join("")}}}();
    </script>

    <script>
        function getUrlParams() {
            const params = new URLSearchParams(window.location.search);
            return {
                ov: params.get('ov') || '',
                cliente: params.get('cliente') || '',
                ruta: params.get('ruta') || '',
                notas: params.get('notas') || '',
                fecha_ov: params.get('fecha_ov') || '',
                cantidad_bultos: parseInt(params.get('bultos')) || 0,
                usuario: params.get('usuario') || '',
                observaciones: params.get('obs') || ''
            };
        }

        let orderData = getUrlParams();

        if (!orderData.ov) {
            orderData = {
                ov: "SO-03210",
                cliente: "HOTEL MARGARITAS Y GIRASOLES",
                ruta: "VENECIA - RIO CUARTO",
                notas: "NO FACTURAR - ES UN PENDIENTE DE ENTREGA",
                fecha_ov: "2025-12-08",
                cantidad_bultos: 3,
                usuario: "Bodega",
                observaciones: ""
            };
        }

        orderData.fecha_alisto = new Date().toLocaleString('es-CR', {
            day: '2-digit',
            month: 'short',
            year: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
        });

        function createQRData(bultoActual) {
            return `${orderData.ov}|${bultoActual}/${orderData.cantidad_bultos}|${orderData.ruta}`;
        }

        function createLabelHTML(bultoActual, totalBultos, qrContainerId) {
            const notasHTML = orderData.notas 
                ? `<div class="notas-row" title="${orderData.notas}">üìù ${orderData.notas}</div>` 
                : '';

            return `
                <div class="label">
                    <div class="qr-section">
                        <div id="${qrContainerId}" class="qr-container"></div>
                        <span class="qr-label">Escanear</span>
                    </div>
                    <div class="main-section">
                        <div class="header-row">
                            <span class="logo">VAROSA</span>
                            <span class="ov-num">${orderData.ov}</span>
                            <span class="ruta-badge">üìç ${orderData.ruta}</span>
                        </div>
                        <div class="info-row cliente-row">
                            <span class="info-label">Cliente:</span>
                            <span class="info-value" title="${orderData.cliente}">${orderData.cliente}</span>
                        </div>
                        ${notasHTML}
                    </div>
                    <div class="bulto-section">
                        <span class="bulto-label">Bulto</span>
                        <div class="bulto-display">
                            <div class="bulto-box">${bultoActual}</div>
                            <span class="bulto-de">/</span>
                            <div class="bulto-box">${totalBultos}</div>
                        </div>
                    </div>
                </div>
            `;
        }

        function generateContent() {
            const contentArea = document.getElementById('content-area');

            if (orderData.cantidad_bultos < 1) {
                contentArea.innerHTML = `
                    <div class="error-message">
                        <h2>‚ö†Ô∏è Error</h2>
                        <p>No se especific√≥ la cantidad de bultos o es inv√°lida.</p>
                        <p>Verifique los par√°metros e intente de nuevo.</p>
                    </div>
                `;
                return;
            }

            contentArea.innerHTML = `
                <div class="order-info">
                    <div class="order-info-item">
                        <span class="order-info-label">Orden de Venta</span>
                        <span class="order-info-value">${orderData.ov}</span>
                    </div>
                    <div class="order-info-item">
                        <span class="order-info-label">Cliente</span>
                        <span class="order-info-value">${orderData.cliente}</span>
                    </div>
                    <div class="order-info-item">
                        <span class="order-info-label">Ruta</span>
                        <span class="order-info-value">${orderData.ruta}</span>
                    </div>
                    <div class="order-info-item">
                        <span class="order-info-label">Cantidad de Bultos</span>
                        <span class="order-info-value" style="color: #4ecdc4; font-size: 1.5rem;">${orderData.cantidad_bultos}</span>
                    </div>
                    ${orderData.notas ? `
                    <div class="order-info-item" style="grid-column: 1 / -1;">
                        <span class="order-info-label">Notas</span>
                        <span class="order-info-value" style="color: #ffa500;">${orderData.notas}</span>
                    </div>
                    ` : ''}
                </div>

                <div class="preview-container">
                    <div class="preview-title">Vista previa de ${orderData.cantidad_bultos} etiqueta(s) a imprimir:</div>
                    <div class="labels-preview" id="labels-preview"></div>
                </div>

                <div class="print-actions">
                    <button class="btn btn-primary" onclick="window.print()">
                        üñ®Ô∏è Imprimir Etiquetas
                    </button>
                    <button class="btn btn-secondary" onclick="window.close()">
                        ‚úï Cerrar
                    </button>
                </div>

                <div class="instructions">
                    <h3>üìã Instrucciones de impresi√≥n</h3>
                    <ol>
                        <li>Verifique que la impresora SATO est√© encendida y con etiquetas</li>
                        <li>Haga clic en <strong>"Imprimir Etiquetas"</strong></li>
                        <li>Seleccione la impresora <strong>SATO CG408TT</strong></li>
                        <li>Verifique tama√±o de papel: <strong>110mm x 25mm</strong></li>
                        <li>M√°rgenes: <strong>Ninguno</strong></li>
                        <li>Haga clic en Imprimir</li>
                    </ol>
                </div>
            `;

            generateLabels();
        }

        function generateLabels() {
            const previewContainer = document.getElementById('labels-preview');
            const printContainer = document.getElementById('print-container');

            if (!previewContainer) return;

            let previewHTML = '';
            let printHTML = '';

            for (let i = 1; i <= orderData.cantidad_bultos; i++) {
                previewHTML += createLabelHTML(i, orderData.cantidad_bultos, `qr-preview-${i}`);
                printHTML += createLabelHTML(i, orderData.cantidad_bultos, `qr-print-${i}`);
            }

            previewContainer.innerHTML = previewHTML;
            printContainer.innerHTML = printHTML;

            // Generate QR codes using embedded library
            for (let i = 1; i <= orderData.cantidad_bultos; i++) {
                const qrData = createQRData(i);
                const qr = QRCode.create(qrData, 'M');
                const svg = QRCode.toSVG(qr, { size: 65, margin: 1 });

                const previewEl = document.getElementById(`qr-preview-${i}`);
                if (previewEl) previewEl.innerHTML = svg;

                const printEl = document.getElementById(`qr-print-${i}`);
                if (printEl) printEl.innerHTML = svg;
            }
        }

        document.addEventListener('DOMContentLoaded', generateContent);
    </script>
</body>
</html>
