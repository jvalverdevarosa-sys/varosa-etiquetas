<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Etiqueta VAROSA 4x2</title>

<style>
    :root{
        /* Etiqueta 4 x 2  (ancho x alto) */
        --label-width: 101.6mm;   /* 4"  */
        --label-height: 50.8mm;   /* 2"  */
        --padding: 2mm;
    }

    /* ==== CONFIGURACIÓN DE PÁGINA PARA SATO (HORIZONTAL 4x2) ==== */
    @page{
        size: var(--label-width) var(--label-height);
        margin: 0;
    }

    *{
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        -webkit-print-color-adjust: exact !important;
        print-color-adjust: exact !important;
    }

    html, body{
        width: 100%;
        height: 100%;
        font-family: Arial, Helvetica, sans-serif;
    }

    /* ======== SOLO PANTALLA ======== */
    @media screen{
        body{
            background:#e5e7eb;
            display:flex;
            flex-direction:column;
            align-items:center;
            padding:20px;
        }
        .controles{
            background:#fff;
            padding:16px 20px;
            border-radius:10px;
            box-shadow:0 2px 10px rgba(0,0,0,.15);
            margin-bottom:20px;
            max-width:500px;
            width:100%;
        }
        .controles h2{
            margin-bottom:6px;
        }
        .controles p{
            font-size:13px;
            color:#4b5563;
            margin-bottom:8px;
        }
        .controles button{
            background:#2563eb;
            color:#fff;
            border:none;
            padding:8px 16px;
            border-radius:6px;
            cursor:pointer;
            font-size:13px;
            margin-right:8px;
        }
        .controles button.secondary{
            background:#6b7280;
        }
        .etiquetas-container{
            display:flex;
            flex-direction:column;
            gap:16px;
            align-items:center;
        }
        .etiqueta-wrapper{
            box-shadow:0 4px 15px rgba(0,0,0,.2);
            background:#fff;
        }
        .etiqueta-label{
            background:#fef3c7;
            padding:4px 10px;
            font-size:11px;
            font-weight:bold;
            color:#92400e;
            border-radius:5px 5px 0 0;
        }
    }

    /* ======== SOLO IMPRESIÓN ======== */
    @media print{
        body{
            background:#fff !important;
        }
        .controles,
        .etiqueta-label{
            display:none !important;
        }
        .etiquetas-container{
            display:block;
        }
        .etiqueta-wrapper{
            width:var(--label-width);
            height:var(--label-height);
            page-break-after:always;
        }
        .etiqueta-wrapper:last-child{
            page-break-after:avoid;
        }
    }

    /* ======== DISEÑO DE LA ETIQUETA ======== */
    .etiqueta{
        width:var(--label-width);
        height:var(--label-height);
        padding:var(--padding);
        border-radius:1.5mm;
        border:0.25mm solid #000;
        display:flex;
        flex-direction:column;
        justify-content:space-between;
    }

    /* Header: VAROSA + doc + fecha/hora */
    .header{
        display:flex;
        justify-content:space-between;
        align-items:flex-start;
        gap:2mm;
        margin-bottom:1mm;
    }
    .empresa{
        font-size:4mm;
        font-weight:bold;
        text-transform:uppercase;
    }
    .doc-box{
        border:0.25mm solid #000;
        padding:1mm 2mm;
        font-size:2.2mm;
        min-width:30mm;
    }
    .doc-line{
        display:flex;
        justify-content:space-between;
    }
    .doc-label{
        font-weight:bold;
        margin-right:1mm;
    }

    /* Zona central datos */
    .contenido{
        flex:1;
        margin-top:0.5mm;
        margin-bottom:2mm;
        font-size:3mm;
        line-height:1.25;
    }
    .campo{
        margin-bottom:0.8mm;
    }
    .campo strong{
        text-transform:uppercase;
    }
    .campo .valor{
        font-weight:bold;
    }

    .linea{
        border-top:0.25mm solid #000;
        margin-top:0.8mm;
        margin-bottom:0.8mm;
    }

    /* Pie: cajas de empaque */
    .footer{
        display:flex;
        justify-content:flex-end;
        align-items:stretch;
        gap:2mm;
        margin-top:auto;
    }
    .box-nro{
        border:0.25mm solid #000;
        padding:1mm 3mm;
        min-width:16mm;
        text-align:center;
        font-size:4mm;
        font-weight:bold;
    }
    .box-nro small{
        display:block;
        font-size:2.4mm;
        font-weight:normal;
        margin-bottom:1mm;
    }
</style>

</head>
<body>

<div class="controles">
    <h2>Etiquetas VAROSA</h2>
    <p>Se generará una etiqueta por cada bulto.</p>
    <button onclick="window.print()">Imprimir todas</button>
    <button class="secondary" onclick="cargarDemo()">Cargar demo</button>
    <div style="font-size:12px;margin-top:8px;background:#ecfdf3;padding:6px;border-radius:4px;">
        <strong>Chrome:</strong> Tamaño papel = 4 x 2 (101.6 × 50.8 mm) · Márgenes = Ninguno · Escala = 100%
    </div>
</div>

<div id="etiquetasContainer" class="etiquetas-container"></div>

<script>
    // ==== MAPEO DE USUARIOS / ALISTADORES ====
    const mapeoUsuarios = {
        "auxiliarbodegavarosa": "Anthony Nuñez",
        "auxiliarbodegavarosa1": "Andrés Otéro",
        "auxiliarbodegavarosa2": "Orlando Contreras",
        "auxiliarbodegavarosa3": "Michael Arce",
        "luisrodrguezjimnez1": "Luis Rodríguez Jiménez"
    };

    function obtenerNombreUsuario(username) {
        if (!username) return "Sin asignar";
        const usernameLimpio = username.trim().toLowerCase();
        for (const [key, nombre] of Object.entries(mapeoUsuarios)) {
            if (
                usernameLimpio === key.toLowerCase() ||
                usernameLimpio.includes(key.toLowerCase())
            ) {
                return nombre;
            }
        }
        return username;
    }

    // --- Datos DEMO ---
    const demo = {
        empresa: "VAROSA",
        documento: "SO-08194",
        fecha: "09/12/2025",
        hora: "07:11 p.m.",
        ruta: "FORTUNA - CASTILLO",
        cliente: "NAYARA HOTELS SRL",
        nota: "",
        alistador: obtenerNombreUsuario("auxiliarbodegavarosa1"),
        totalBultos: 3
    };

    // Generar una etiqueta HTML para un bulto
    function crearEtiqueta(datos, nroBulto){
        return `
        <div class="etiqueta-wrapper">
            <div class="etiqueta-label">Etiqueta ${nroBulto} de ${datos.totalBultos}</div>
            <div class="etiqueta">
                <div class="header">
                    <div class="empresa">${datos.empresa}</div>
                    <div class="doc-box">
                        <div class="doc-line">
                            <span class="doc-label">DOC:</span>
                            <span>${datos.documento}</span>
                        </div>
                        <div class="doc-line">
                            <span class="doc-label">FECHA:</span>
                            <span>${datos.fecha}</span>
                        </div>
                        <div class="doc-line">
                            <span class="doc-label">HORA:</span>
                            <span>${datos.hora}</span>
                        </div>
                    </div>
                </div>

                <div class="contenido">
                    <div class="campo">
                        <strong>Ruta: </strong>
                        <span class="valor">${datos.ruta}</span>
                    </div>
                    <div class="campo">
                        <strong>Cliente: </strong>
                        <span class="valor">${datos.cliente}</span>
                    </div>
                    <div class="campo">
                        <strong>Alistador: </strong>
                        <span class="valor">${datos.alistador}</span>
                    </div>
                    ${datos.nota ? `
                    <div class="campo">
                        <strong>Nota: </strong>
                        <span class="valor">${datos.nota}</span>
                    </div>` : ""}
                    <div class="linea"></div>
                </div>

                <div class="footer">
                    <div class="box-nro">
                        <small>EMPAQUE</small>
                        ${nroBulto}
                    </div>
                    <div class="box-nro">
                        <small>DE</small>
                        ${datos.totalBultos}
                    </div>
                </div>
            </div>
        </div>`;
    }

    function generarEtiquetas(datos){
        const cont = document.getElementById("etiquetasContainer");
        cont.innerHTML = "";
        for(let i=1;i<=datos.totalBultos;i++){
            cont.insertAdjacentHTML("beforeend", crearEtiqueta(datos, i));
        }
    }

    function cargarDemo(){
        generarEtiquetas(demo);
    }

    // Cargar datos desde la URL como en tu versión original
    function cargarDesdeURL(){
        const p = new URLSearchParams(window.location.search);
        if(!p.has("ov")){
            generarEtiquetas(demo);
            return;
        }
        const total = parseInt(p.get("bultos") || "1", 10);
        const alistadorRaw = p.get("alistador") || p.get("user") || "";
        const alistadorNombre = obtenerNombreUsuario(alistadorRaw);

        const datos = {
            empresa: "VAROSA",
            documento: p.get("ov") || "",
            fecha: p.get("fecha") || "",
            hora: p.get("hora")  || "",
            ruta: p.get("ruta")  || "",
            cliente: p.get("cliente") || "",
            nota: p.get("notas") || "",
            alistador: alistadorNombre,
            totalBultos: isNaN(total) ? 1 : total
        };
        generarEtiquetas(datos);
    }

    document.addEventListener("DOMContentLoaded", cargarDesdeURL);
</script>

</body>
</html>
